(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,79744,e=>{"use strict";e.s(["default",()=>W],79744);var t=e.i(43476),n=e.i(18566),a=e.i(71645),s=e.i(79735),r=e.i(39964),i=e.i(59544),l=e.i(3812),o=e.i(61418),c=e.i(57688),d=e.i(31368);function u(e){let{selectedToken:n,onSelect:s,excludeToken:r,disabled:i=!1,label:l}=e,[o,u]=(0,a.useState)(!1),m=(0,a.useRef)(null),p=d.TOKENS[n],x=Object.keys(d.TOKENS).filter(e=>e!==r);return(0,a.useEffect)(()=>{function e(e){m.current&&!m.current.contains(e.target)&&u(!1)}if(o)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]),(0,t.jsxs)("div",{className:"relative",ref:m,children:[l&&(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:l}),(0,t.jsxs)("button",{type:"button",onClick:()=>!i&&u(!o),disabled:i,className:"\n          w-full flex items-center gap-3 px-4 py-3 rounded-xl\n          border border-white/10 bg-white/5\n          transition-all duration-200\n          ".concat(i?"opacity-50 cursor-not-allowed":"hover:bg-white/10 hover:border-white/20 active:bg-white/15","\n        "),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[p.logoUrl&&(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center overflow-hidden",children:(0,t.jsx)(c.default,{src:p.logoUrl,alt:p.symbol,width:32,height:32,className:"w-6 h-6"})}),(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)("span",{className:"text-white font-semibold",children:p.symbol}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:p.name})]})]}),(0,t.jsx)("svg",{className:"w-5 h-5 text-gray-400 transition-transform duration-200 ".concat(o?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&!i&&(0,t.jsx)("div",{className:"absolute z-50 w-full mt-2 rounded-xl border border-white/10 bg-gray-900/95 backdrop-blur-xl shadow-2xl overflow-hidden animate-fadeIn",children:(0,t.jsx)("div",{className:"py-2",children:x.map(e=>{let a=d.TOKENS[e],r=e===n;return(0,t.jsxs)("button",{type:"button",onClick:()=>{s(e),u(!1)},className:"\n                    w-full flex items-center gap-3 px-4 py-3\n                    transition-colors duration-200\n                    ".concat(r?"bg-blue-500/20 text-white":"hover:bg-white/5 text-gray-300","\n                  "),children:[a.logoUrl&&(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center overflow-hidden",children:(0,t.jsx)(c.default,{src:a.logoUrl,alt:a.symbol,width:32,height:32,className:"w-6 h-6"})}),(0,t.jsxs)("div",{className:"flex flex-col items-start flex-1",children:[(0,t.jsx)("span",{className:"font-semibold",children:a.symbol}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:a.name})]}),r&&(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},e)})})})]})}var m=e.i(32098),p=e.i(72813);let x="0xE592427A0AEce92De3Edee1F18E0157C05861564",h=[{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoterV2.QuoteExactInputSingleParams",name:"params",type:"tuple"}],name:"quoteExactInputSingle",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoterV2.QuoteExactOutputSingleParams",name:"params",type:"tuple"}],name:"quoteExactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"}],f=[{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMinimum",type:"uint256"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct ISwapRouter.ExactInputSingleParams",name:"params",type:"tuple"}],name:"exactInputSingle",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMaximum",type:"uint256"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct ISwapRouter.ExactOutputSingleParams",name:"params",type:"tuple"}],name:"exactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"}];function y(e){let{isOpen:n,onClose:s,quote:r,gasEstimate:l,needsApproval:c,onConfirm:d,onApprove:u,isSwapping:x,isApproving:h}=e,[f,y]=(0,a.useState)(""),[w,g]=(0,a.useState)(null),j=async()=>{if(!f)return void g("Password is required");g(null);try{c?await u(f):await d(f)}catch(e){console.error("Transaction failed:",e),g(e instanceof Error?e.message:"Transaction failed")}},b=()=>{x||h||(y(""),g(null),s())},N=r.priceImpact>5;return(0,t.jsx)(m.Modal,{isOpen:n,onClose:b,title:c?"Approve Token":"Confirm Swap",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"You Pay"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-white",children:r.amountIn})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"text-lg font-semibold text-white",children:r.tokenIn})})]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})})}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"You Receive"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-white",children:r.amountOut}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Min: ",r.minAmountOutFormatted]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"text-lg font-semibold text-white",children:r.tokenOut})})]})]}),(0,t.jsxs)("div",{className:"space-y-3 p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Exchange Rate"}),(0,t.jsxs)("span",{className:"text-white font-medium",children:["1 ",r.tokenIn," = ",r.exchangeRate," ",r.tokenOut]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Price Impact"}),(0,t.jsxs)("span",{className:"font-medium ".concat(r.priceImpact>5?"text-yellow-400":"text-green-400"),children:[r.priceImpact.toFixed(2),"%"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Slippage Tolerance"}),(0,t.jsxs)("span",{className:"text-white font-medium",children:[r.slippageTolerance,"%"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Pool Fee"}),(0,t.jsxs)("span",{className:"text-white font-medium",children:[(r.poolFee/1e4).toFixed(2),"%"]})]}),l&&(0,t.jsxs)("div",{className:"flex justify-between text-sm pt-3 border-t border-white/10",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Network Fee"}),(0,t.jsxs)("span",{className:"text-white font-medium",children:["~",parseFloat(l.totalCostEth).toFixed(6)," ETH"]})]})]}),N&&(0,t.jsx)(o.Alert,{variant:"warning",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("svg",{className:"w-5 h-5 text-yellow-400 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-400",children:"High Price Impact"}),(0,t.jsxs)("p",{className:"text-sm text-gray-300 mt-1",children:["This swap has a price impact of ",r.priceImpact.toFixed(2),"%. Consider reducing the swap amount."]})]})]})}),c&&(0,t.jsx)(o.Alert,{variant:"info",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-400 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-blue-400",children:"Approval Required"}),(0,t.jsxs)("p",{className:"text-sm text-gray-300 mt-1",children:["You need to approve ",r.tokenIn," spending before you can swap. This is a one-time transaction."]})]})]})}),(0,t.jsx)("div",{children:(0,t.jsx)(p.PasswordInput,{label:"Confirm with Password",value:f,onChange:e=>y(e.target.value),placeholder:"Enter your wallet password",disabled:x||h,autoComplete:"current-password"})}),w&&(0,t.jsx)(o.Alert,{variant:"error",children:w}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(i.Button,{variant:"secondary",onClick:b,disabled:x||h,className:"flex-1",children:"Cancel"}),(0,t.jsx)(i.Button,{variant:"primary",onClick:j,disabled:!f||x||h,isLoading:x||h,className:"flex-1",children:c?h?"Approving...":"Approve":x?"Swapping...":"Confirm Swap"})]}),(x||h)&&(0,t.jsxs)("div",{className:"text-center text-sm text-gray-400",children:[(0,t.jsx)("p",{children:"Please wait while the transaction is being processed..."}),(0,t.jsx)("p",{className:"mt-1",children:"Do not close this window."})]})]})})}var w=e.i(68663),g=e.i(49870),j=e.i(47015),b=e.i(48259),N=e.i(7120),v=e.i(94367),k=e.i(56147);let I=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"}];var T=e.i(99749);class E extends Error{constructor(e,t,n){super(e),(0,T._)(this,"code",void 0),(0,T._)(this,"originalError",void 0),this.name="SwapError",this.code=t,this.originalError=n}}let S=null;function A(){return S||(S=new N.JsonRpcProvider(j.env.NEXT_PUBLIC_RPC_URL)),S}function C(e){if(!e||!(0,k.isAddress)(e))throw new E("Invalid Ethereum address: ".concat(e),"INVALID_PAIR")}async function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=null;for(let s=0;s<t;s++)try{return await e()}catch(e){if(a=e,e instanceof E&&"INVALID_PAIR"===e.code)throw e;if(s===t-1)break;await new Promise(e=>setTimeout(e,n*Math.pow(2,s)))}throw new E("Network operation failed after ".concat(t," retries: ").concat(null==a?void 0:a.message),"NETWORK_ERROR",a)}async function P(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,s=j.env.NEXT_PUBLIC_NETWORK,r=(0,d.getTokenAddress)(e,s),i=(0,d.getTokenAddress)(t,s);if(!r||!i)throw new E("Token not supported on current network","INVALID_PAIR");if(r===i)throw new E("Cannot swap same token","INVALID_PAIR");let l=d.TOKENS[e],o=d.TOKENS[t],c=(0,v.parseUnits)(n,l.decimals);return F(async()=>{try{let s=A(),l=new b.Contract("0x61fFE014bA17989E743c5F6cB21bF9697530B21e",h,s),[d,u,m,p]=await l.quoteExactInputSingle.staticCall({tokenIn:r,tokenOut:i,amountIn:c,fee:500,sqrtPriceLimitX96:0}),x=(0,v.formatUnits)(d,o.decimals),f=(parseFloat(x)/parseFloat(n)).toFixed(6),y=parseFloat(f),w=100*Math.abs((y-1)/1);if(w>15)throw new E("Price impact too high: ".concat(w.toFixed(2),"%"),"EXCESSIVE_PRICE_IMPACT");let g=d*BigInt(Math.floor(1e4*(1-a/100)))/BigInt(1e4),j=(0,v.formatUnits)(g,o.decimals);return{tokenIn:e,tokenOut:t,amountIn:n,amountOut:x,amountInRaw:c.toString(),amountOutRaw:d.toString(),exchangeRate:f,priceImpact:w,minAmountOut:g.toString(),minAmountOutFormatted:j,slippageTolerance:a,poolFee:500,estimatedGas:p.toString(),timestamp:Date.now()}}catch(e){if(e instanceof E)throw e;if(e instanceof Error&&e.message.includes("STF"))throw new E("Insufficient liquidity for this swap amount","INSUFFICIENT_LIQUIDITY",e);throw new E("Failed to get swap quote: ".concat(e instanceof Error?e.message:"Unknown error"),"NETWORK_ERROR",e)}})}async function L(e,t,n){return C(e),C(t),F(async()=>{try{let a=A(),s=new b.Contract(e,I,a),r=await s.allowance(t,x),i=r.toString(),l=r>=BigInt(n);return{tokenAddress:e,spenderAddress:x,allowance:i,isSufficient:l,requiredAmount:n}}catch(e){throw new E("Failed to check allowance: ".concat(e instanceof Error?e.message:"Unknown error"),"NETWORK_ERROR",e)}})}async function R(e,t,n){return C(t),F(async()=>{try{let a=A(),s=new b.Contract(t,I,a).connect(e),r=await s.approve(x,n),i=await r.wait();if(!i||0===i.status)throw new E("Token approval transaction failed","APPROVAL_FAILED");return r.hash}catch(e){if(e instanceof E)throw e;throw new E("Token approval failed: ".concat(e instanceof Error?e.message:"Unknown error"),"APPROVAL_FAILED",e)}})}async function O(e,t,n){return F(async()=>{try{let e,a=A(),s=await a.getFeeData(),r=s.maxFeePerGas||(0,v.parseUnits)("50","gwei"),i=s.maxPriorityFeePerGas||(0,v.parseUnits)("2","gwei"),l=BigInt(t.estimatedGas)*BigInt(120)/BigInt(100);n&&(e=BigInt(5e4));let o=(l+(e||BigInt(0)))*r,c=(0,v.formatUnits)(o,"ether");return{approvalGasLimit:e,swapGasLimit:l,maxFeePerGas:r,maxPriorityFeePerGas:i,totalCostEth:c,totalCostWei:o}}catch(e){throw new E("Failed to estimate gas: ".concat(e instanceof Error?e.message:"Unknown error"),"NETWORK_ERROR",e)}})}async function _(e,t){let n=j.env.NEXT_PUBLIC_NETWORK,a=(0,d.getTokenAddress)(t.tokenIn,n),s=(0,d.getTokenAddress)(t.tokenOut,n);if(!a||!s)throw new E("Token not supported on current network","INVALID_PAIR");return F(async()=>{try{let n=A(),r=new b.Contract(a,I,n);if(await r.balanceOf(e.address)<BigInt(t.amountInRaw))throw new E("Insufficient token balance for swap","INSUFFICIENT_BALANCE");let i=await n.getBalance(e.address),l=await O(e,t,!1);if(i<l.totalCostWei)throw new E("Insufficient ETH for gas. Required: ".concat(l.totalCostEth," ETH"),"INSUFFICIENT_BALANCE");let o=Math.floor(Date.now()/1e3)+1200,c={tokenIn:a,tokenOut:s,fee:t.poolFee,recipient:e.address,deadline:o,amountIn:t.amountInRaw,amountOutMinimum:t.minAmountOut,sqrtPriceLimitX96:0},d=new b.Contract(x,f,n).connect(e),u=await d.exactInputSingle(c,{maxFeePerGas:l.maxFeePerGas,maxPriorityFeePerGas:l.maxPriorityFeePerGas,gasLimit:l.swapGasLimit}),m=await u.wait();if(!m||0===m.status)throw new E("Swap transaction failed","SWAP_FAILED");return u.hash}catch(e){if(e instanceof E)throw e;if(e instanceof Error&&e.message.includes("Too little received"))throw new E("Slippage tolerance exceeded. Try increasing slippage or reducing amount.","SLIPPAGE_EXCEEDED",e);throw new E("Swap execution failed: ".concat(e instanceof Error?e.message:"Unknown error"),"SWAP_FAILED",e)}})}function B(e){return({INSUFFICIENT_BALANCE:"Insufficient balance to complete this swap.",INSUFFICIENT_LIQUIDITY:"Not enough liquidity available for this swap amount.",EXCESSIVE_PRICE_IMPACT:"Price impact is too high. Try reducing the swap amount.",SLIPPAGE_EXCEEDED:"Price changed too much. Try increasing slippage tolerance.",APPROVAL_FAILED:"Failed to approve token spending. Please try again.",SWAP_FAILED:"Swap transaction failed. Please try again.",QUOTE_EXPIRED:"Price quote expired. Fetching new quote...",INVALID_PAIR:"Invalid token pair selected.",NETWORK_ERROR:"Network error. Please check your connection and try again.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again."})[e.code]||e.message}var U=e.i(77279);let q=[.1,.5,1];function M(){let{address:e,isUnlocked:n}=(0,s.useWallet)(),{data:c}=(0,U.useBalance)(),[m,p]=(0,a.useState)("USDC"),[x,h]=(0,a.useState)("USDT"),[f,b]=(0,a.useState)(""),[N,v]=(0,a.useState)(.5),[k,I]=(0,a.useState)(""),[T,S]=(0,a.useState)(!1),{quote:A,gasEstimate:C,allowance:F,status:M,error:W,isLoadingQuote:D,isApproving:K,isSwapping:V,txHash:X,fetchQuote:G,approve:z,swap:Q,clearError:H,reset:Y,needsApproval:J}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{refreshInterval:n=3e4,autoRefresh:s=!0}=t,[r,i]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[m,p]=(0,a.useState)("idle"),[x,h]=(0,a.useState)(null),[f,y]=(0,a.useState)(null),b=(0,a.useRef)(null),N=(0,a.useRef)(null),v=(0,a.useCallback)(()=>{b.current&&(clearTimeout(b.current),b.current=null)},[]),k=(0,a.useCallback)(async(t,a,r,l)=>{if(!e)return void h("Wallet not connected");if(!r||0>=parseFloat(r))return void h("Invalid amount");v(),p("fetching-quote"),h(null);try{let c=await P(t,a,r,l);i(c);let m=j.env.NEXT_PUBLIC_NETWORK,x=(0,d.getTokenAddress)(t,m);if(x){let t=await L(x,e,c.amountInRaw);u(t),o(null)}N.current={tokenIn:t,tokenOut:a,amountIn:r,slippage:l},s&&(b.current=setTimeout(()=>{if(N.current){let e=N.current;k(e.tokenIn,e.tokenOut,e.amountIn,e.slippage)}},n)),p("idle")}catch(e){console.error("Failed to fetch quote:",e),e instanceof E?h(B(e)):h("Failed to fetch quote. Please try again."),p("error"),i(null),u(null),o(null)}},[e,s,n,v]),I=(0,a.useCallback)(async t=>{if(!r||!c||!e)return void h("Missing required data for approval");if(c.isSufficient)return void h("Approval not needed");p("approving"),h(null);try{let n=await (0,g.unlockWallet)(t),a=new w.Wallet(n.privateKey),s=await R(a,c.tokenAddress,c.requiredAmount);console.log("Approval transaction:",s);let r=await L(c.tokenAddress,e,c.requiredAmount);u(r),p("idle")}catch(e){console.error("Approval failed:",e),e instanceof E?h(B(e)):h("Token approval failed. Please try again."),p("error")}},[r,c,e]),T=(0,a.useCallback)(async t=>{if(!r||!c||!e)return void h("Missing required data for swap");if(!c.isSufficient)return void h("Token approval required before swap");if(!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4;return Date.now()-e.timestamp<t}(r)){h("Quote expired. Please refresh."),p("error");return}v(),p("swapping"),h(null);try{let e=await (0,g.unlockWallet)(t),n=new w.Wallet(e.privateKey),a=await O(n,r,!1);o(a);let s=await _(n,r);y(s),console.log("Swap transaction:",s),p("success")}catch(e){console.error("Swap failed:",e),e instanceof E?h(B(e)):h("Swap failed. Please try again."),p("error")}},[r,c,e,v]),S=(0,a.useCallback)(()=>{h(null),"error"===m&&p("idle")},[m]),A=(0,a.useCallback)(()=>{v(),i(null),o(null),u(null),p("idle"),h(null),y(null),N.current=null},[v]);(0,a.useEffect)(()=>()=>{v()},[v]);let C="fetching-quote"===m,F="approving"===m,U="swapping"===m,q=!!c&&!c.isSufficient;return{quote:r,gasEstimate:l,allowance:c,status:m,error:x,isLoadingQuote:C,isApproving:F,isSwapping:U,txHash:f,fetchQuote:k,approve:I,swap:T,clearError:S,reset:A,needsApproval:q}}(e),Z=null==c?void 0:c.find(e=>e.symbol===m);(0,a.useEffect)(()=>{if(f&&parseFloat(f)>0&&m&&x){let e=setTimeout(()=>{G(m,x,f,N)},500);return()=>clearTimeout(e)}Y()},[m,x,f,N,G,Y]),(0,a.useEffect)(()=>{"success"===M&&(b(""),Y())},[M,Y]);let $=async e=>{await Q(e)},ee=async e=>{await z(e)},et=n&&f&&parseFloat(f)>0&&A&&!D&&!J,en=n&&A&&J,ea=!!(Z&&f&&parseFloat(f)>parseFloat(Z.balanceFormatted));return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Card,{className:"max-w-lg mx-auto",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Swap Tokens"}),(0,t.jsx)("button",{type:"button",className:"p-2 rounded-lg hover:bg-white/5 transition-colors",title:"Slippage Settings",children:(0,t.jsxs)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400",children:"Slippage Tolerance"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[q.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>{v(e),I("")},className:"\n                    px-4 py-2 rounded-lg font-medium transition-colors\n                    ".concat(N!==e||k?"bg-white/5 text-gray-300 hover:bg-white/10":"bg-blue-500 text-white","\n                  "),children:[e,"%"]},e)),(0,t.jsx)(l.Input,{type:"number",value:k,onChange:e=>(e=>{I(e);let t=parseFloat(e);!isNaN(t)&&t>0&&t<=50&&v(t)})(e.target.value),placeholder:"Custom",className:"w-24",min:"0",max:"50",step:"0.1"})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400",children:"From"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(u,{selectedToken:m,onSelect:p,excludeToken:x}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Input,{type:"number",value:f,onChange:e=>b(e.target.value),placeholder:"0.0",className:"text-2xl pr-20",min:"0",step:"any"}),(0,t.jsx)("button",{type:"button",onClick:()=>{Z&&b(Z.balanceFormatted)},className:"absolute right-3 top-1/2 -translate-y-1/2 px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 text-sm font-medium hover:bg-blue-500/30 transition-colors",children:"MAX"})]}),Z&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Balance:"}),(0,t.jsxs)("span",{className:"text-white font-medium",children:[parseFloat(Z.balanceFormatted).toFixed(4)," ",m]})]})]})]}),(0,t.jsx)("div",{className:"flex justify-center -my-2",children:(0,t.jsx)("button",{type:"button",onClick:()=>{p(x),h(m)},className:"p-3 rounded-full bg-gray-800 border-4 border-gray-900 hover:bg-gray-700 transition-colors z-10",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})})})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-400",children:"To"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(u,{selectedToken:x,onSelect:h,excludeToken:m}),(0,t.jsx)("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:D?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{className:"text-gray-400",children:"Fetching quote..."})]}):A?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-white",children:parseFloat(A.amountOut).toFixed(6)}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Min received: ",parseFloat(A.minAmountOutFormatted).toFixed(6)]})]}):(0,t.jsx)("p",{className:"text-gray-400",children:"Enter amount to see quote"})})]})]}),A&&!D&&(0,t.jsxs)("div",{className:"space-y-2 p-4 rounded-xl bg-white/5 border border-white/10",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Rate"}),(0,t.jsxs)("span",{className:"text-white",children:["1 ",m," = ",A.exchangeRate," ",x]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Price Impact"}),(0,t.jsxs)("span",{className:A.priceImpact>5?"text-yellow-400":"text-green-400",children:[A.priceImpact.toFixed(2),"%"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Pool Fee"}),(0,t.jsxs)("span",{className:"text-white",children:[(A.poolFee/1e4).toFixed(2),"%"]})]}),C&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Network Fee"}),(0,t.jsxs)("span",{className:"text-white",children:["~",parseFloat(C.totalCostEth).toFixed(6)," ETH"]})]})]}),ea&&(0,t.jsxs)(o.Alert,{variant:"error",children:["Insufficient ",m," balance"]}),W&&(0,t.jsx)(o.Alert,{variant:"error",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("span",{children:W}),(0,t.jsx)("button",{type:"button",onClick:H,className:"text-red-400 hover:text-red-300",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),"success"===M&&X&&(0,t.jsx)(o.Alert,{variant:"success",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Swap Successful!"}),(0,t.jsx)("a",{href:"https://etherscan.io/tx/".concat(X),target:"_blank",rel:"noopener noreferrer",className:"text-sm underline hover:no-underline",children:"View on Etherscan"})]})}),n?en?(0,t.jsxs)(i.Button,{variant:"primary",onClick:()=>S(!0),disabled:ea,className:"w-full",children:["Approve ",m]}):(0,t.jsx)(i.Button,{variant:"primary",onClick:()=>S(!0),disabled:!et||ea,isLoading:D,className:"w-full",children:D?"Loading...":et?"Review Swap":"Enter Amount"}):(0,t.jsx)(i.Button,{variant:"secondary",disabled:!0,className:"w-full",children:"Unlock Wallet to Swap"})]})}),A&&(0,t.jsx)(y,{isOpen:T,onClose:()=>S(!1),quote:A,gasEstimate:C,needsApproval:J,onConfirm:$,onApprove:ee,isSwapping:V,isApproving:K})]})}function W(){let e=(0,n.useRouter)(),{isUnlocked:r,hasExistingWallet:i}=(0,s.useWallet)();return(0,a.useEffect)(()=>{i()||e.push("/onboarding")},[i,e]),(0,a.useEffect)(()=>{i()&&!r&&e.push("/unlock")},[i,r,e]),(0,t.jsx)("div",{className:"min-h-screen p-4 sm:p-6 lg:p-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-white mb-2",children:"Token Swap"}),(0,t.jsx)("p",{className:"text-gray-400",children:"Swap stablecoins instantly using Uniswap V3"})]}),(0,t.jsx)("div",{className:"mb-6 p-4 rounded-xl bg-blue-500/10 border border-blue-500/20",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-400 mt-0.5 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm text-blue-400 font-semibold",children:"About Token Swaps"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"Swaps are executed on Uniswap V3 with on-chain prices. You'll need to approve the token before your first swap. Network fees apply for each transaction."})]})]})}),(0,t.jsx)(M,{}),(0,t.jsxs)("div",{className:"mt-8 p-6 rounded-xl bg-white/5 border border-white/10",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"How it works"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm text-gray-300",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-blue-400 font-semibold text-xs",children:"1"})}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{className:"text-white",children:"Select tokens:"})," Choose the token you want to swap from and the token you want to receive."]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-blue-400 font-semibold text-xs",children:"2"})}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{className:"text-white",children:"Enter amount:"})," Type the amount you want to swap. The output amount will be calculated automatically."]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-blue-400 font-semibold text-xs",children:"3"})}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{className:"text-white",children:"Review details:"})," Check the exchange rate, price impact, and fees before confirming."]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0 mt-0.5",children:(0,t.jsx)("span",{className:"text-blue-400 font-semibold text-xs",children:"4"})}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{className:"text-white",children:"Approve & Swap:"})," First-time swaps require token approval. Then confirm the swap with your password."]})]})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-white mb-2",children:"Important Notes"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm text-gray-400",children:[(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-blue-400 mt-1",children:"•"}),(0,t.jsx)("span",{children:"Slippage tolerance protects you from price changes during the swap"})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-blue-400 mt-1",children:"•"}),(0,t.jsx)("span",{children:"Price impact shows how much your trade affects the market price"})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-blue-400 mt-1",children:"•"}),(0,t.jsx)("span",{children:"Network fees (gas) are paid in ETH and vary based on network congestion"})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-blue-400 mt-1",children:"•"}),(0,t.jsx)("span",{children:"Quotes refresh automatically every 30 seconds"})]})]})]})]})]})})}}]);